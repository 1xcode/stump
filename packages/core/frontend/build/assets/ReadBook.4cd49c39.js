var I=Object.defineProperty;var A=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var v=(e,n,o)=>n in e?I(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,N=(e,n)=>{for(var o in n||(n={}))L.call(n,o)&&v(e,o,n[o]);if(A)for(var o of A(n))R.call(n,o)&&v(e,o,n[o]);return e};import{k as T,l as M,_ as O,m as W,o as E,q as _,r as m,j as c,F as d,a as t,I as j,t as C,A as D,u as w,v as P,w as y,x as B,T as F,S,y as $,R as z,z as K,C as q,D as H,E as G,G as V,i as Q}from"./index.c3e0d6de.js";import{u as U}from"./useQuery.336f3166.js";function Z(){var e=!1,n=[],o=new Set,l={subscribe:function(r){return o.add(r),function(){return void o.delete(r)}},start:function(r,u){if(e){var s=[];return o.forEach(function(a){s.push(E(a,r,{transitionOverride:u}))}),Promise.all(s)}else return new Promise(function(a){n.push({animation:[r,u],resolve:a})})},set:function(r){return o.forEach(function(u){T(u,r)})},stop:function(){o.forEach(function(r){M(r)})},mount:function(){return e=!0,n.forEach(function(r){var u=r.animation,s=r.resolve;l.start.apply(l,O([],W(u),!1)).then(s)}),function(){e=!1,l.stop()}}};return l}function J(){var e=_(Z);return m.exports.useEffect(e.mount,[]),e}var f=new Map;f.set("bold",function(e){return c(d,{children:[t("line",{x1:"216",y1:"128",x2:"40",y2:"128",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"}),t("polyline",{points:"112 56 40 128 112 200",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"24"})]})});f.set("duotone",function(e){return c(d,{children:[t("line",{x1:"216",y1:"128",x2:"40",y2:"128",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),t("polyline",{points:"112 56 40 128 112 200",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"})]})});f.set("fill",function(){return t(d,{children:t("path",{d:"M224,128a8,8,0,0,1-8,8H120v64a8,8,0,0,1-4.9,7.4,8.5,8.5,0,0,1-3.1.6,8.3,8.3,0,0,1-5.7-2.3l-72-72a8.1,8.1,0,0,1,0-11.4l72-72a8.4,8.4,0,0,1,8.8-1.7A8,8,0,0,1,120,56v64h96A8,8,0,0,1,224,128Z"})})});f.set("light",function(e){return c(d,{children:[t("line",{x1:"216",y1:"128",x2:"40",y2:"128",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"}),t("polyline",{points:"112 56 40 128 112 200",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"12"})]})});f.set("thin",function(e){return c(d,{children:[t("line",{x1:"216",y1:"128",x2:"40",y2:"128",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"}),t("polyline",{points:"112 56 40 128 112 200",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"8"})]})});f.set("regular",function(e){return c(d,{children:[t("line",{x1:"216",y1:"128",x2:"40",y2:"128",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"}),t("polyline",{points:"112 56 40 128 112 200",fill:"none",stroke:e,strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"16"})]})});var X=function(n,o){return C(n,o,f)},b=m.exports.forwardRef(function(e,n){return t(j,N({},Object.assign({ref:n},e,{renderPath:X})))});b.displayName="ArrowLeft";var Y=b;function ee(e,n){return D.put(`/media/${e}/progress/${n}`)}function ne({title:e,currentPage:n,pages:o,visible:l}){const{id:r}=w();if(!r)throw new Error("woah boy how strange 0.o");return t(P,{children:l&&c(d,{children:[t(y.nav,{initial:{opacity:0,y:-100},animate:{opacity:1,y:0},exit:{opacity:0,y:-100},transition:{duration:.2,ease:"easeInOut"},className:"fixed top-0 p-4 w-full bg-opacity-75 bg-gray-700 text-white",children:c("div",{className:"flex justify-between items-center w-full",children:[c("div",{className:"flex items-center space-x-4",children:[t("a",{className:"flex items-center",title:"Go to media overview",href:`/books/${r}`,children:t(Y,{size:"1.25rem"})}),t(B,{size:"sm",children:e})]}),t("div",{className:"flex items-center",children:"TODO: idk what"})]})}),t(y.nav,{initial:{opacity:0,y:100},animate:{opacity:1,y:0},exit:{opacity:0,y:100},transition:{duration:.2,ease:"easeInOut"},className:"fixed bottom-0 p-4 w-full bg-opacity-75 bg-gray-700 text-white",children:c("div",{className:"flex space-x-2",children:[c(F,{children:["Page ",n," of ",o]}),t(S,{}),t("div",{children:"TODO: page previews"})]})})]})})}const te={x:"-200%",opacity:.5,transition:{duration:.35}},oe={opacity:.1,x:"200%"},re={x:"0%",opacity:1,transition:{duration:.35}},ie=[te,oe,re],se={x:"200%",opacity:1,transition:{duration:.35}},ae={opacity:.1,x:"-200%"},ce={x:"0%",opacity:1,transition:{duration:.35}},le=[se,ae,ce];function ue({currentPage:e,media:n,onPageChange:o,getPageUrl:l}){const r=J(),[u,{toggle:s,off:a}]=$(!1),h=z.useRef(e);m.exports.useEffect(()=>{h.current=e},[e]);function g(i,k){r.start(i[0]).then(()=>{r.set(i[1]),o(k),r.start(i[2])})}function p(i){console.log("changing page to",i),i>0&&i<=n.pages?i>h.current?g(ie,i):g(le,i):q.error("The page you are trying to access does not exist")}function x(i){i>0&&i<=n.pages}return K("right, left, space, esc",(i,k)=>{switch(k.key){case"right":p(h.current+1);break;case"left":p(h.current-1);break;case"space":s();break;case"esc":a();break}}),c("div",{className:"h-full w-full flex justify-center items-center",children:[t("div",{className:"flex-1 w-full h-full z-50",onClick:()=>p(e-1),onMouseEnter:()=>x(e-1)}),t(y.img,{animate:r,transition:{ease:"easeOut"},onClick:s,className:"object-scale-down max-h-full",src:l(e),onError:i=>{i.target.src="/src/favicon.png"}}),t("div",{className:"flex-1 w-full h-full z-50",onClick:()=>p(e+1),onMouseEnter:()=>x(e+1)}),t(ne,{title:n.name,currentPage:e,pages:n.pages,visible:u})]})}function pe(){const e=H(),{id:n,page:o}=w();if(n){if(!o)return e(`/books/${n}/pages/1`),null}else throw new Error("Media id is required");function l(a){r(),e(`/books/${n}/pages/${a}`)}const{mutate:r}=G(()=>ee(n,parseInt(o,10))),{isLoading:u,data:s}=U("getMediaById",{queryFn:async()=>Q(n).then(a=>a.data)});if(u)return t("div",{children:"Loading..."});if(!s)throw new Error("Media not found");return s.extension.match(/cbr|cbz/)?t(ue,{media:s,currentPage:parseInt(o,10),getPageUrl:a=>V(n,a),onPageChange:l}):t("div",{children:"Not a comic book; Can't do that yet! :)"})}export{pe as default};
